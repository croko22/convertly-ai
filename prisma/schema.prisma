generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ─── ENUMS ───────────────────────────────────────────────

enum OrderStatus {
  PENDING
  PAID
  CANCELLED
  REFUNDED
}

// ─── MODELS ──────────────────────────────────────────────

/// The course/product — the core entity everything revolves around.
model Course {
  id          String    @id @default(cuid())
  title       String
  description String
  price       Decimal   @db.Decimal(10, 2)
  image       String?
  userId      String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?

  landing LandingPage?
  lessons Lesson[]
  orders  Order[]
}

/// The AI-generated landing page. One per course.
/// `sections` stores structured JSON blocks generated by AI
/// (hero, features, testimonials, CTA, etc.)
model LandingPage {
  id          String   @id @default(cuid())
  slug        String   @unique
  headline    String
  subheadline String
  sections    Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  courseId String @unique
  course   Course @relation(fields: [courseId], references: [id], onDelete: Cascade)
}

/// Individual lesson within a course (member area content).
model Lesson {
  id       String  @id @default(cuid())
  title    String
  videoUrl String?
  content  String? @db.Text
  order    Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  courseId String
  course   Course @relation(fields: [courseId], references: [id], onDelete: Cascade)
}

/// Purchase record. Simulates a Hotmart-style checkout flow.
model Order {
  id        String      @id @default(cuid())
  userEmail String
  status    OrderStatus @default(PENDING)
  total     Decimal     @db.Decimal(10, 2)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  courseId String
  course   Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([userEmail])
  @@index([status])
}
